<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Teachable Machine Project</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      color: #222;
    }
    nav {
      background: #222;
      padding: 0.75rem 1rem;
    }
    nav a {
      color: #fff;
      text-decoration: none;
      margin-right: 1rem;
      font-size: 0.95rem;
    }
    nav a:hover {
      text-decoration: underline;
    }
    main {
      max-width: 900px;
      margin: 2rem auto;
      padding: 1.5rem;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    h1 {
      margin-top: 0;
    }
    #webcam-container, #label-container {
      margin-top: 1rem;
    }
    #label-container div {
      margin-bottom: 0.25rem;
    }
    button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <!-- Simple nav (you can edit these links to match your actual pages) -->
  <nav>
    <a href="index.html">Home</a>
    <a href="teachable-machine.html">Teachable Machine</a>
  </nav>

  <main>
    <h1>Teachable Machine: Emotion Classifier</h1>
    <p>
      This page shows our Teachable Machine model running in the browser.
      It uses the webcam to try and recognize different classes we trained
      (for example: neutral, smiling, and frustrated).
    </p>

    <button type="button" onclick="init()">Start Webcam &amp; Model</button>

    <div id="webcam-container"></div>
    <div id="label-container"></div>

    <h2>How it works</h2>
    <p>
      We trained this model using Google’s Teachable Machine tool. We collected
      examples for each class using our own faces, then exported the model to
      TensorFlow.js so it could run directly in the browser on this page.
    </p>
  </main>

  <!-- Teachable Machine + TensorFlow scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

  <script type="text/javascript">
    // ✅ Your Teachable Machine model URL (with the trailing slash)
    const URL = "https://teachablemachine.withgoogle.com/models/pMKj7tFEN/";

    let model, webcam, labelContainer, maxPredictions;

    async function init() {
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";

      // Load the model and metadata
      model = await tmImage.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();

      // Setup webcam
      const flip = true; // flip webcam horizontally
      webcam = new tmImage.Webcam(320, 240, flip);
      await webcam.setup(); // ask for camera access
      await webcam.play();
      window.requestAnimationFrame(loop);

      // Put webcam in the page
      document.getElementById("webcam-container").innerHTML = "";
      document.getElementById("webcam-container").appendChild(webcam.canvas);

      // Prepare label container
      labelContainer = document.getElementById("label-container");
      labelContainer.innerHTML = "";
      for (let i = 0; i < maxPredictions; i++) {
        const div = document.createElement("div");
        labelContainer.appendChild(div);
      }
    }

    async function loop() {
      webcam.update(); // update webcam frame
      await predict();
      window.requestAnimationFrame(loop);
    }

    async function predict() {
      const prediction = await model.predict(webcam.canvas);
      for (let i = 0; i < maxPredictions; i++) {
        const className = prediction[i].className;
        const prob = prediction[i].probability.toFixed(2);
        labelContainer.childNodes[i].innerHTML = `${className}: ${prob}`;
      }
    }
  </script>
</body>
</html>
